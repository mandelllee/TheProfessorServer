<!DOCTYPE html>
<html lang="en">

<head>
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/justified-nav/justified-nav.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
	<div style="text-align:center;">
		<h1>LeafLift node data</h1>
	</div>

	<div id="charts"></div>
    <script>
    //    var url = 'http://api-quadroponic.rhcloud.com/v1/report/soil/potato';



    var plotData = function(url, elementid, field, title, error_margin) {
    	var host = '';
    	if( error_margin === undefined )error_margin=20;


        Plotly.d3.json( host + url, function(rows) {

            var trace = {
                type: 'scatter', // set the chart type
                mode: 'lines', // connect points with lines
                x: rows.map(function(row) { // set the x-data
                    return new Date(row['date']);
                }),
                y: rows.map(function(row) { // set the x-data
                    
                	switch( field ){
                		case("temp"):
                			return row[field] * 1.8 + 32;
                		break;
                		default:
                			return row[field];
                	}

                }),
                error_y: {
			        array: rows.map(function(row){    // set the height of the error bars
			          return error_margin;
			        }),
			        color: "#a9a9a9",
			        thickness: 0.5,                   // set the thickness of the error bars
			        width: 0
			      },
                line: { // set the width of the line.
                    width: 5,
                    color: "#004200"
                }
            };

            var layout = {
                yaxis: {
                    title: title
                }, // set the y axis title
                xaxis: {
                    showgrid: false,
                    tickangle:0,
                    tickformat: "%a %I:%M%p %e-%b",
	                _tickformat: "%a %e-%b",
	                categoryorder: "category decending"
                },
                wide_margin: { // update the left, bottom, right, top margin
                    l: 160,
                    b: 100,
                    r: 160,
                    t: 20
                },
                margin: { // update the left, bottom, right, top margin
                    l: 50,
                    b: 100,
                    r: 5,
                    t: 20
                }
            };

            var base = document.getElementById('charts');
            var element = document.createElement("div");
            var hr = document.createElement("hr");
            element.id = elementid;
            
            if( base.children.length>0){
            	base.appendChild( hr );

            }
            base.appendChild( element );
			
            Plotly.plot(element, [trace], layout, {
                showLink: false
            });

        });
    };

    // plotData('potato_soil.json', "soil_chart_potato", "soil_1", "Soil Moisture (Mint)");
    // plotData('pepper_soil.json', "soil_chart_pepper", "soil_1", "Soil Moisture (Succulent)");
    // plotData('aqua_ph.json', "ph_cart_aqua", "ph", "Water pH", .05);
    // plotData('aqua_ph.json', "temp_cart_aqua", "temp", "Water Temp (f)", .5);

    // var config = {
    // 	'nodes': [
    // 		{ 	nodename: 'potato',
    // 			charts: [
    // 				{ soil}
    // 			]
    // 	]

    // };

    var cmd = "http://api-quadroponic.rhcloud.com//v1/report/";


    plotData(cmd+'soil/potato', "soil_chart_potato", "soil_1", "Soil Moisture (Mint)");

    plotData(cmd+'soil/pepper', "soil_chart_pepper3", "soil_3", "Soil Moisture (Succulent)");
    plotData(cmd+'soil/pepper', "soil_chart_pepper1", "soil_1", "Soil Moisture (Dome)");
    
    plotData(cmd+'water/aqua', "ph_cart_aqua", "ph", "Aquarium pH", .02);
    plotData(cmd+'water/aqua', "temp_cart_aqua", "temp", "Aquarium Temp (f)", .5);
	plotData(cmd+'water/aqua', "flow_cart_aqua", "water_flow_lph", "Aquarium Flow (LPH)", .5);

	plotData(cmd+'environment/tempo', "lux_chart_tempo", "light_lux", "LUX (window)", 500);
	plotData(cmd+'environment/tempo', "humidity_chart_tempo", "air_humidity", "Humidity (window)", 5);
	plotData(cmd+'environment/tempo', "temp_chart_tempo", "air_temp_f", "Temp (F) (window)", 2);


	plotData(cmd+'soil/ford', "soil_chart_ford", "soil_1", "Soil Moisture (Basil)", 2);
	plotData(cmd+'environment/ford', "humidity_chart_ford", "air_humidity", "Humidity(Basil)", 2);
	plotData(cmd+'environment/ford', "temp_chart_ford", "air_temp_f", "Temp(F) (Basil)", 2);



    </script>
</body>

</html>